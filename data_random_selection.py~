#! /usr/bin/env python

import io, os
import random, json

numberOfData = 1125458


inputfile = 'data/input/source/yelp_academic_dataset_review.json'

outputfile5star = 'data/input/bow/5StarsSamples.json'
outputfile4star = 'data/input/bow/4StarsSamples.json'
outputfile3star = 'data/input/bow/3StarsSamples.json'
outputfile2star = 'data/input/bow/2StarsSamples.json'
outputfile1star = 'data/input/bow/1StarsSamples.json'

#Define how many samples using for every type of data
_bow = 5000
_training = 10000
_validation = 5000
_testing = 1000

numberOfSample = _bow+_training+_validation+_testing

training_Outputfile = 'data/input/' + str(_training) + 'trainingSamples.json'
validation_Outputfile = 'data/input/' + str(_validation) + 'validationSamples.json'
testing_Outputfile = 'data/input/' + str(_testing) + 'testingSamples.json'

randomSelectionList = random.sample(xrange(0, numberOfData), numberOfSample)
bow_RandomSelectionList = randomSelectionList[0:_bow]
training_RandomSelectionList = randomSelectionList[_bow:_bow+_training]
validation_RandomSelectionList = randomSelectionList[_bow+_training:_bow+_training+_validation]
testing_RandomSelectionList = randomSelectionList[_bow+_training+_validation:_bow+_training+_validation+_testing]

for i in xrange(1,6):
    if os.path.isfile('data/input/bow/' + str(i) + 'StarsSamples.json'):
        os.remove('data/input/bow/' + str(i) + 'StarsSamples.json')

if os.path.isfile(training_Outputfile):
    os.remove(training_Outputfile)
if os.path.isfile(validation_Outputfile):
    os.remove(validation_Outputfile)
if os.path.isfile(testing_Outputfile):
    os.remove(testing_Outputfile)

with open(outputfile5star, 'a') as _5starfile, open(outputfile4star, 'a') as _4starfile, open(outputfile3star, 'a') as _3starfile, open(outputfile2star, 'a') as _2starfile, open(outputfile1star, 'a') as _1starfile, open(training_Outputfile, 'a') as training_Outfile, open(validation_Outputfile, 'a') as validation_Outfile, open(testing_Outputfile, 'a') as testing_Outfile, open(inputfile) as inputfileobject:
    for i, line in enumerate(inputfileobject):
        print(i)
        if i in training_RandomSelectionList:
               training_Outfile.write(unicode(line))
        elif i in validation_RandomSelectionList:
               validation_Outfile.write(unicode(line))
        elif i in testing_RandomSelectionList:
               testing_Outfile.write(unicode(line))
        elif i in bow_RandomSelectionList:
            if line == '\n':
                break
            data = json.loads(line)
            if data["text"] =="":
                break
            if (data["stars"] == 5):
                _5starfile.write((data["text"].encode('utf-8')))
            elif (data["stars"] == 4):
                _4starfile.write((data["text"].encode('utf-8')))
            elif (data["stars"] == 3):
                _3starfile.write((data["text"].encode('utf-8')))
            elif (data["stars"] == 2):
                _2starfile.write((data["text"].encode('utf-8')))
            elif (data["stars"] == 1):
                _1starfile.write((data["text"].encode('utf-8')))           

print("Finish selecting data. Now you can move to the feature extraction part")
